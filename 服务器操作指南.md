# 服务器操作指南

## 📍 项目位置
```
/root/kehuxinxi-backend
```

## 🔧 服务器端操作步骤

### 1. 连接到服务器
```bash
ssh root@47.113.177.228
```

### 2. 进入项目目录
```bash
cd /root/kehuxinxi-backend
```

### 3. 检查文件是否同步成功
```bash
ls -la
```
应该能看到以下文件和目录：
- `app.js`
- `package.json`
- `config/`
- `controllers/`
- `models/`
- `routes/`
- 等等...

### 4. 检查服务状态
```bash
# 查看 PM2 进程状态
pm2 status

# 查看服务日志
pm2 logs kehuxinxi-backend

# 查看实时日志
pm2 logs kehuxinxi-backend --lines 50
```

### 5. 如果需要重启服务
```bash
# 重启服务
pm2 restart kehuxinxi-backend

# 或者停止后重新启动
pm2 stop kehuxinxi-backend
pm2 start app.js --name kehuxinxi-backend
```

### 6. 检查服务是否正常运行
```bash
# 检查端口是否监听
netstat -tlnp | grep 3000

# 或者使用 curl 测试
curl http://localhost:3000
```

### 7. 查看错误日志（如果有问题）
```bash
# 查看 PM2 错误日志
pm2 logs kehuxinxi-backend --err

# 查看系统日志
journalctl -u pm2-root -f
```

## 🚀 常用命令

### 服务管理
```bash
# 启动服务
pm2 start app.js --name kehuxinxi-backend

# 停止服务
pm2 stop kehuxinxi-backend

# 重启服务
pm2 restart kehuxinxi-backend

# 删除服务
pm2 delete kehuxinxi-backend

# 查看所有服务
pm2 list
```

### 日志查看
```bash
# 查看实时日志
pm2 logs kehuxinxi-backend -f

# 查看最近 100 行日志
pm2 logs kehuxinxi-backend --lines 100

# 清空日志
pm2 flush kehuxinxi-backend
```

### 性能监控
```bash
# 查看资源使用情况
pm2 monit

# 查看详细信息
pm2 show kehuxinxi-backend
```

## 🔍 故障排查

### 如果服务无法启动
1. 检查依赖是否安装：
   ```bash
   npm install --production
   ```

2. 检查端口是否被占用：
   ```bash
   netstat -tlnp | grep 3000
   ```

3. 检查文件权限：
   ```bash
   ls -la
   chmod +x app.js
   ```

4. 手动启动测试：
   ```bash
   node app.js
   ```

### 如果访问不了网站
1. 检查防火墙：
   ```bash
   ufw status
   ```

2. 检查端口开放：
   ```bash
   iptables -L
   ```

3. 检查服务状态：
   ```bash
   systemctl status pm2-root
   ```

## 📝 注意事项

1. **备份重要数据**：在修改前先备份数据库和配置文件
2. **查看日志**：遇到问题时先查看日志文件
3. **权限问题**：确保文件有正确的读写权限
4. **端口冲突**：确保 3000 端口没有被其他服务占用

## 🆘 紧急情况

如果服务完全无法访问：
```bash
# 强制重启 PM2
pm2 kill
pm2 start app.js --name kehuxinxi-backend

# 或者重启服务器
reboot
```
